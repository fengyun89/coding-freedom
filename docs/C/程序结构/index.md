## 源文件 和 头文件

### 扩展名

C 标准中没有提源文件和头文件的扩展名，因此取决于编译器。

C 源文件的扩展名通常为 `.c`。

C 头文件的扩展名通常为 `.h`。

## main 函数

C 程序启动时调用名为 `main` 的函数。

main 函数的返回类型必须是 `int`，可以不带参数

```c
int main(void) { /* ... */ }
```

或带两个参数

```c
int main(int argc, char *argv[]) { /* ... */ }
```

`argc` 是命令行参数的个数，argc 至少为1，因为程序名称本身被计算在内。

`argv` 是一个指向字符串数组的指针，每个字符串对应一个命令行参数。

返回 0 表示程序成功执行并正常退出，返回非 0 表示异常退出。如果没有显式地写 return 语句，编译器会隐式地在 main 函数的末尾插入 `return 0;`。

## C 程序的编译过程

### 预处理

源文件以及通过预处理指令 `#include` 包含的所有`头文件`和源文件一起称为`预处理翻译单元`，预处理翻译单元经过预处理后称为`翻译单元`，以 `.i` 为扩展名

```
clang <源文件> -E -o x.i
```

或

```
clang <源文件> -E > x.i
```

`-E` 表示只进行预处理。

如果不指定输出文件，预处理结果默认输出到标准输出。

### 编译

对翻译单元进行词法分析、语法分析、语义分析及优化后，生成汇编文件，以 `.s` 为扩展名

```
clang <翻译单元> -S -o x.s
```

可以预处理和编译合并称一个步骤

```
clang <源文件> -S -o x.s
```

如果不用 `-o` 指定输出文件，生成的汇编文件名与 `<源文件>|<翻译单元>` 相同。

### 汇编

将汇编代码转换成机器代码，生成目标文件，以 `.o` 为扩展名

```
clang <源文件>|<翻译单元>|<汇编代码文件> -c -o x.o
```

如果不用 `-o` 指定输出文件，生成的目标文件名与 `<源文件>|<翻译单元>|<汇编代码文件>` 相同。

### 链接

将多个目标文件和库文件链接成一个可执行文件，以 `.out` 为扩展名

```
clang <目标文件1> <目标文件2> ... <目标文件n> -o x.out
```

如果不用 `-o` 指定输出文件，生成的可执行文件名为 `a.out`。

